---
layout: post
title: Array
categories: ç¼–ç¨‹
tags: æ‰©å±•è¿ç®—ç¬¦
excerpt: ç®€è¦ ES è¯­æ³•
---

# æ•°ç»„çš„æ‰©å±•

## æ‰©å±•è¿ç®—ç¬¦

### å«ä¹‰

æ‰©å±•è¿ç®—ç¬¦ï¼ˆspreadï¼‰æ˜¯ä¸‰ä¸ªç‚¹ï¼ˆ`...`ï¼‰ã€‚å®ƒå¥½æ¯” rest å‚æ•°çš„é€†è¿ç®—ï¼Œå°†ä¸€ä¸ªæ•°ç»„è½¬ä¸ºç”¨é€—å·åˆ†éš”çš„å‚æ•°åºåˆ—ã€‚

```javascript
console.log(...[1, 2, 3])
// 1 2 3

console.log(1, ...[2, 3, 4], 5)
// 1 2 3 4 5

[...document.querySelectorAll('div')]
// [<div>, <div>, <div>]
```

è¯¥è¿ç®—ç¬¦ä¸»è¦ç”¨äºå‡½æ•°è°ƒç”¨ã€‚

```javascript
function push(array, ...items) {
  array.push(...items);
}

function add(x, y) {
  return x + y;
}

const numbers = [4, 38];
add(...numbers) // 42
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`array.push(...items)`å’Œ`add(...numbers)`è¿™ä¸¤è¡Œï¼Œéƒ½æ˜¯å‡½æ•°çš„è°ƒç”¨ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨äº†æ‰©å±•è¿ç®—ç¬¦ã€‚è¯¥è¿ç®—ç¬¦å°†ä¸€ä¸ªæ•°ç»„ï¼Œå˜ä¸ºå‚æ•°åºåˆ—ã€‚

æ‰©å±•è¿ç®—ç¬¦ä¸æ­£å¸¸çš„å‡½æ•°å‚æ•°å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œéå¸¸çµæ´»ã€‚

```javascript
function f(v, w, x, y, z) { }
const args = [0, 1];
f(-1, ...args, 2, ...[3]);
```

æ‰©å±•è¿ç®—ç¬¦åé¢è¿˜å¯ä»¥æ”¾ç½®è¡¨è¾¾å¼ã€‚

```javascript
const arr = [
  ...(x > 0 ? ['a'] : []),
  'b',
];
```

å¦‚æœæ‰©å±•è¿ç®—ç¬¦åé¢æ˜¯ä¸€ä¸ªç©ºæ•°ç»„ï¼Œåˆ™ä¸äº§ç”Ÿä»»ä½•æ•ˆæœã€‚

```javascript
[...[], 1]
// [1]
```

æ³¨æ„ï¼Œåªæœ‰å‡½æ•°è°ƒç”¨æ—¶ï¼Œæ‰©å±•è¿ç®—ç¬¦æ‰å¯ä»¥æ”¾åœ¨åœ†æ‹¬å·ä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

```javascript
(...[1, 2])
// Uncaught SyntaxError: Unexpected number

console.log((...[1, 2]))
// Uncaught SyntaxError: Unexpected number

console.log(...[1, 2])
// 1 2
```

ä¸Šé¢ä¸‰ç§æƒ…å†µï¼Œæ‰©å±•è¿ç®—ç¬¦éƒ½æ”¾åœ¨åœ†æ‹¬å·é‡Œé¢ï¼Œä½†æ˜¯å‰ä¸¤ç§æƒ…å†µä¼šæŠ¥é”™ï¼Œå› ä¸ºæ‰©å±•è¿ç®—ç¬¦æ‰€åœ¨çš„æ‹¬å·ä¸æ˜¯å‡½æ•°è°ƒç”¨ã€‚

### æ›¿ä»£å‡½æ•°çš„ apply æ–¹æ³•

ç”±äºæ‰©å±•è¿ç®—ç¬¦å¯ä»¥å±•å¼€æ•°ç»„ï¼Œæ‰€ä»¥ä¸å†éœ€è¦`apply`æ–¹æ³•ï¼Œå°†æ•°ç»„è½¬ä¸ºå‡½æ•°çš„å‚æ•°äº†ã€‚

```javascript
// ES5 çš„å†™æ³•
function f(x, y, z) {
  // ...
}
var args = [0, 1, 2];
f.apply(null, args);

// ES6çš„å†™æ³•
function f(x, y, z) {
  // ...
}
let args = [0, 1, 2];
f(...args);
```

ä¸‹é¢æ˜¯æ‰©å±•è¿ç®—ç¬¦å–ä»£`apply`æ–¹æ³•çš„ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œåº”ç”¨`Math.max`æ–¹æ³•ï¼Œç®€åŒ–æ±‚å‡ºä¸€ä¸ªæ•°ç»„æœ€å¤§å…ƒç´ çš„å†™æ³•ã€‚

```javascript
// ES5 çš„å†™æ³•
Math.max.apply(null, [14, 3, 77])

// ES6 çš„å†™æ³•
Math.max(...[14, 3, 77])

// ç­‰åŒäº
Math.max(14, 3, 77);
```

ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äº JavaScript ä¸æä¾›æ±‚æ•°ç»„æœ€å¤§å…ƒç´ çš„å‡½æ•°ï¼Œæ‰€ä»¥åªèƒ½å¥—ç”¨`Math.max`å‡½æ•°ï¼Œå°†æ•°ç»„è½¬ä¸ºä¸€ä¸ªå‚æ•°åºåˆ—ï¼Œç„¶åæ±‚æœ€å¤§å€¼ã€‚æœ‰äº†æ‰©å±•è¿ç®—ç¬¦ä»¥åï¼Œå°±å¯ä»¥ç›´æ¥ç”¨`Math.max`äº†ã€‚

å¦ä¸€ä¸ªä¾‹å­æ˜¯é€šè¿‡`push`å‡½æ•°ï¼Œå°†ä¸€ä¸ªæ•°ç»„æ·»åŠ åˆ°å¦ä¸€ä¸ªæ•°ç»„çš„å°¾éƒ¨ã€‚

```javascript
// ES5çš„ å†™æ³•
var arr1 = [0, 1, 2];
var arr2 = [3, 4, 5];
Array.prototype.push.apply(arr1, arr2);

// ES6 çš„å†™æ³•
let arr1 = [0, 1, 2];
let arr2 = [3, 4, 5];
arr1.push(...arr2);
```

ä¸Šé¢ä»£ç çš„ ES5 å†™æ³•ä¸­ï¼Œ`push`æ–¹æ³•çš„å‚æ•°ä¸èƒ½æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥åªå¥½é€šè¿‡`apply`æ–¹æ³•å˜é€šä½¿ç”¨`push`æ–¹æ³•ã€‚æœ‰äº†æ‰©å±•è¿ç®—ç¬¦ï¼Œå°±å¯ä»¥ç›´æ¥å°†æ•°ç»„ä¼ å…¥`push`æ–¹æ³•ã€‚

ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚

```javascript
// ES5
new (Date.bind.apply(Date, [null, 2015, 1, 1]))
// ES6
new Date(...[2015, 1, 1]);
```

### æ‰©å±•è¿ç®—ç¬¦çš„åº”ç”¨

**ï¼ˆ1ï¼‰å¤åˆ¶æ•°ç»„**

æ•°ç»„æ˜¯å¤åˆçš„æ•°æ®ç±»å‹ï¼Œç›´æ¥å¤åˆ¶çš„è¯ï¼Œåªæ˜¯å¤åˆ¶äº†æŒ‡å‘åº•å±‚æ•°æ®ç»“æ„çš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯å…‹éš†ä¸€ä¸ªå…¨æ–°çš„æ•°ç»„ã€‚

```javascript
const a1 = [1, 2];
const a2 = a1;

a2[0] = 2;
a1 // [2, 2]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`a2`å¹¶ä¸æ˜¯`a1`çš„å…‹éš†ï¼Œè€Œæ˜¯æŒ‡å‘åŒä¸€ä»½æ•°æ®çš„å¦ä¸€ä¸ªæŒ‡é’ˆã€‚ä¿®æ”¹`a2`ï¼Œä¼šç›´æ¥å¯¼è‡´`a1`çš„å˜åŒ–ã€‚

ES5 åªèƒ½ç”¨å˜é€šæ–¹æ³•æ¥å¤åˆ¶æ•°ç»„ã€‚

```javascript
const a1 = [1, 2];
const a2 = a1.concat();

a2[0] = 2;
a1 // [1, 2]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`a1`ä¼šè¿”å›åŸæ•°ç»„çš„å…‹éš†ï¼Œå†ä¿®æ”¹`a2`å°±ä¸ä¼šå¯¹`a1`äº§ç”Ÿå½±å“ã€‚

æ‰©å±•è¿ç®—ç¬¦æä¾›äº†å¤åˆ¶æ•°ç»„çš„ç®€ä¾¿å†™æ³•ã€‚

```javascript
const a1 = [1, 2];
// å†™æ³•ä¸€
const a2 = [...a1];
// å†™æ³•äºŒ
const [...a2] = a1;
```

ä¸Šé¢çš„ä¸¤ç§å†™æ³•ï¼Œ`a2`éƒ½æ˜¯`a1`çš„å…‹éš†ã€‚

**ï¼ˆ2ï¼‰åˆå¹¶æ•°ç»„**

æ‰©å±•è¿ç®—ç¬¦æä¾›äº†æ•°ç»„åˆå¹¶çš„æ–°å†™æ³•ã€‚

```javascript
const arr1 = ['a', 'b'];
const arr2 = ['c'];
const arr3 = ['d', 'e'];

// ES5 çš„åˆå¹¶æ•°ç»„
arr1.concat(arr2, arr3);
// [ 'a', 'b', 'c', 'd', 'e' ]

// ES6 çš„åˆå¹¶æ•°ç»„
[...arr1, ...arr2, ...arr3]
// [ 'a', 'b', 'c', 'd', 'e' ]
```

ä¸è¿‡ï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½æ˜¯æµ…æ‹·è´ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„ã€‚

```javascript
const a1 = [{ foo: 1 }];
const a2 = [{ bar: 2 }];

const a3 = a1.concat(a2);
const a4 = [...a1, ...a2];

a3[0] === a1[0] // true
a4[0] === a1[0] // true
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`a3`å’Œ`a4`æ˜¯ç”¨ä¸¤ç§ä¸åŒæ–¹æ³•åˆå¹¶è€Œæˆçš„æ–°æ•°ç»„ï¼Œä½†æ˜¯å®ƒä»¬çš„æˆå‘˜éƒ½æ˜¯å¯¹åŸæ•°ç»„æˆå‘˜çš„å¼•ç”¨ï¼Œè¿™å°±æ˜¯æµ…æ‹·è´ã€‚å¦‚æœä¿®æ”¹äº†å¼•ç”¨æŒ‡å‘çš„å€¼ï¼Œä¼šåŒæ­¥åæ˜ åˆ°æ–°æ•°ç»„ã€‚

**ï¼ˆ3ï¼‰ä¸è§£æ„èµ‹å€¼ç»“åˆ**

æ‰©å±•è¿ç®—ç¬¦å¯ä»¥ä¸è§£æ„èµ‹å€¼ç»“åˆèµ·æ¥ï¼Œç”¨äºç”Ÿæˆæ•°ç»„ã€‚

```javascript
// ES5
a = list[0], rest = list.slice(1)
// ES6
[a, ...rest] = list
```

ä¸‹é¢æ˜¯å¦å¤–ä¸€äº›ä¾‹å­ã€‚

```javascript
const [first, ...rest] = [1, 2, 3, 4, 5];
first // 1
rest  // [2, 3, 4, 5]

const [first, ...rest] = [];
first // undefined
rest  // []

const [first, ...rest] = ["foo"];
first  // "foo"
rest   // []
```

å¦‚æœå°†æ‰©å±•è¿ç®—ç¬¦ç”¨äºæ•°ç»„èµ‹å€¼ï¼Œåªèƒ½æ”¾åœ¨å‚æ•°çš„æœ€åä¸€ä½ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

```javascript
const [...butLast, last] = [1, 2, 3, 4, 5];
// æŠ¥é”™

const [first, ...middle, last] = [1, 2, 3, 4, 5];
// æŠ¥é”™
```

**ï¼ˆ4ï¼‰å­—ç¬¦ä¸²**

æ‰©å±•è¿ç®—ç¬¦è¿˜å¯ä»¥å°†å­—ç¬¦ä¸²è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚

```javascript
[...'hello']
// [ "h", "e", "l", "l", "o" ]
```

ä¸Šé¢çš„å†™æ³•ï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„å¥½å¤„ï¼Œé‚£å°±æ˜¯èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«å››ä¸ªå­—èŠ‚çš„ Unicode å­—ç¬¦ã€‚

```javascript
'xğŸš€y'.length // 4
[...'xğŸš€y'].length // 3
```

ä¸Šé¢ä»£ç çš„ç¬¬ä¸€ç§å†™æ³•ï¼ŒJavaScript ä¼šå°†å››ä¸ªå­—èŠ‚çš„ Unicode å­—ç¬¦ï¼Œè¯†åˆ«ä¸º 2 ä¸ªå­—ç¬¦ï¼Œé‡‡ç”¨æ‰©å±•è¿ç®—ç¬¦å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼Œæ­£ç¡®è¿”å›å­—ç¬¦ä¸²é•¿åº¦çš„å‡½æ•°ï¼Œå¯ä»¥åƒä¸‹é¢è¿™æ ·å†™ã€‚

```javascript
function length(str) {
  return [...str].length;
}

length('xğŸš€y') // 3
```

å‡¡æ˜¯æ¶‰åŠåˆ°æ“ä½œå››ä¸ªå­—èŠ‚çš„ Unicode å­—ç¬¦çš„å‡½æ•°ï¼Œéƒ½æœ‰è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤ï¼Œæœ€å¥½éƒ½ç”¨æ‰©å±•è¿ç®—ç¬¦æ”¹å†™ã€‚

```javascript
let str = 'xğŸš€y';

str.split('').reverse().join('')
// 'y??x'

[...str].reverse().join('')
// 'yğŸš€x'
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœä¸ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œå­—ç¬¦ä¸²çš„`reverse`æ“ä½œå°±ä¸æ­£ç¡®ã€‚

**ï¼ˆ5ï¼‰å®ç°äº† Iterator æ¥å£çš„å¯¹è±¡**

ä»»ä½•å®šä¹‰äº†éå†å™¨ï¼ˆIteratorï¼‰æ¥å£çš„å¯¹è±¡ï¼ˆå‚é˜… Iterator ä¸€ç« ï¼‰ï¼Œéƒ½å¯ä»¥ç”¨æ‰©å±•è¿ç®—ç¬¦è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚

```javascript
let nodeList = document.querySelectorAll('div');
let array = [...nodeList];
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`querySelectorAll`æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª`NodeList`å¯¹è±¡ã€‚å®ƒä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚è¿™æ—¶ï¼Œæ‰©å±•è¿ç®—ç¬¦å¯ä»¥å°†å…¶è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼ŒåŸå› å°±åœ¨äº`NodeList`å¯¹è±¡å®ç°äº† Iterator ã€‚

```javascript
Number.prototype[Symbol.iterator] = function*() {
  let i = 0;
  let num = this.valueOf();
  while (i < num) {
    yield i++;
  }
}

console.log([...5]) // [0, 1, 2, 3, 4]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå…ˆå®šä¹‰äº†`Number`å¯¹è±¡çš„éå†å™¨æ¥å£ï¼Œæ‰©å±•è¿ç®—ç¬¦å°†`5`è‡ªåŠ¨è½¬æˆ`Number`å®ä¾‹ä»¥åï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±ä¼šè¿”å›è‡ªå®šä¹‰çš„ç»“æœã€‚

å¯¹äºé‚£äº›æ²¡æœ‰éƒ¨ç½² Iterator æ¥å£çš„ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œæ‰©å±•è¿ç®—ç¬¦å°±æ— æ³•å°†å…¶è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚

```javascript
let arrayLike = {
  '0': 'a',
  '1': 'b',
  '2': 'c',
  length: 3
};

// TypeError: Cannot spread non-iterable object.
let arr = [...arrayLike];
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`arrayLike`æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰éƒ¨ç½² Iterator æ¥å£ï¼Œæ‰©å±•è¿ç®—ç¬¦å°±ä¼šæŠ¥é”™ã€‚è¿™æ—¶ï¼Œå¯ä»¥æ”¹ä¸ºä½¿ç”¨`Array.from`æ–¹æ³•å°†`arrayLike`è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚

**ï¼ˆ6ï¼‰Map å’Œ Set ç»“æ„ï¼ŒGenerator å‡½æ•°**

æ‰©å±•è¿ç®—ç¬¦å†…éƒ¨è°ƒç”¨çš„æ˜¯æ•°æ®ç»“æ„çš„ Iterator æ¥å£ï¼Œå› æ­¤åªè¦å…·æœ‰ Iterator æ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œæ¯”å¦‚ Map ç»“æ„ã€‚

```javascript
let map = new Map([
  [1, 'one'],
  [2, 'two'],
  [3, 'three'],
]);

let arr = [...map.keys()]; // [1, 2, 3]
```

Generator å‡½æ•°è¿è¡Œåï¼Œè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ã€‚

```javascript
const go = function*(){
  yield 1;
  yield 2;
  yield 3;
};

[...go()] // [1, 2, 3]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡`go`æ˜¯ä¸€ä¸ª Generator å‡½æ•°ï¼Œæ‰§è¡Œåè¿”å›çš„æ˜¯ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼Œå¯¹è¿™ä¸ªéå†å™¨å¯¹è±¡æ‰§è¡Œæ‰©å±•è¿ç®—ç¬¦ï¼Œå°±ä¼šå°†å†…éƒ¨éå†å¾—åˆ°çš„å€¼ï¼Œè½¬ä¸ºä¸€ä¸ªæ•°ç»„ã€‚

å¦‚æœå¯¹æ²¡æœ‰ Iterator æ¥å£çš„å¯¹è±¡ï¼Œä½¿ç”¨æ‰©å±•è¿ç®—ç¬¦ï¼Œå°†ä¼šæŠ¥é”™ã€‚

```javascript
const obj = {a: 1, b: 2};
let arr = [...obj]; // TypeError: Cannot spread non-iterable object
```

## Array.from()

`Array.from`æ–¹æ³•ç”¨äºå°†ä¸¤ç±»å¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼šç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆarray-like objectï¼‰å’Œå¯éå†ï¼ˆiterableï¼‰çš„å¯¹è±¡ï¼ˆåŒ…æ‹¬ ES6 æ–°å¢çš„æ•°æ®ç»“æ„ Set å’Œ Mapï¼‰ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œ`Array.from`å°†å®ƒè½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚

```javascript
let arrayLike = {
    '0': 'a',
    '1': 'b',
    '2': 'c',
    length: 3
};

// ES5çš„å†™æ³•
var arr1 = [].slice.call(arrayLike); // ['a', 'b', 'c']

// ES6çš„å†™æ³•
let arr2 = Array.from(arrayLike); // ['a', 'b', 'c']
```

å®é™…åº”ç”¨ä¸­ï¼Œå¸¸è§çš„ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡æ˜¯ DOM æ“ä½œè¿”å›çš„ NodeList é›†åˆï¼Œä»¥åŠå‡½æ•°å†…éƒ¨çš„`arguments`å¯¹è±¡ã€‚`Array.from`éƒ½å¯ä»¥å°†å®ƒä»¬è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚

```javascript
// NodeListå¯¹è±¡
let ps = document.querySelectorAll('p');
Array.from(ps).filter(p => {
  return p.textContent.length > 100;
});

// argumentså¯¹è±¡
function foo() {
  var args = Array.from(arguments);
  // ...
}
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`querySelectorAll`æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œå¯ä»¥å°†è¿™ä¸ªå¯¹è±¡è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼Œå†ä½¿ç”¨`filter`æ–¹æ³•ã€‚

åªè¦æ˜¯éƒ¨ç½²äº† Iterator æ¥å£çš„æ•°æ®ç»“æ„ï¼Œ`Array.from`éƒ½èƒ½å°†å…¶è½¬ä¸ºæ•°ç»„ã€‚

```javascript
Array.from('hello')
// ['h', 'e', 'l', 'l', 'o']

let namesSet = new Set(['a', 'b'])
Array.from(namesSet) // ['a', 'b']
```

ä¸Šé¢ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸²å’Œ Set ç»“æ„éƒ½å…·æœ‰ Iterator æ¥å£ï¼Œå› æ­¤å¯ä»¥è¢«`Array.from`è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ã€‚

å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ•°ç»„ï¼Œ`Array.from`ä¼šè¿”å›ä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„æ–°æ•°ç»„ã€‚

```javascript
Array.from([1, 2, 3])
// [1, 2, 3]
```

å€¼å¾—æé†’çš„æ˜¯ï¼Œæ‰©å±•è¿ç®—ç¬¦ï¼ˆ`...`ï¼‰ä¹Ÿå¯ä»¥å°†æŸäº›æ•°æ®ç»“æ„è½¬ä¸ºæ•°ç»„ã€‚

```javascript
// argumentså¯¹è±¡
function foo() {
  const args = [...arguments];
}

// NodeListå¯¹è±¡
[...document.querySelectorAll('div')]
```

æ‰©å±•è¿ç®—ç¬¦èƒŒåè°ƒç”¨çš„æ˜¯éå†å™¨æ¥å£ï¼ˆ`Symbol.iterator`ï¼‰ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰éƒ¨ç½²è¿™ä¸ªæ¥å£ï¼Œå°±æ— æ³•è½¬æ¢ã€‚`Array.from`æ–¹æ³•è¿˜æ”¯æŒç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ã€‚æ‰€è°“ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼Œæœ¬è´¨ç‰¹å¾åªæœ‰ä¸€ç‚¹ï¼Œå³å¿…é¡»æœ‰`length`å±æ€§ã€‚å› æ­¤ï¼Œä»»ä½•æœ‰`length`å±æ€§çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥é€šè¿‡`Array.from`æ–¹æ³•è½¬ä¸ºæ•°ç»„ï¼Œè€Œæ­¤æ—¶æ‰©å±•è¿ç®—ç¬¦å°±æ— æ³•è½¬æ¢ã€‚

```javascript
Array.from({ length: 3 });
// [ undefined, undefined, undefined ]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`Array.from`è¿”å›äº†ä¸€ä¸ªå…·æœ‰ä¸‰ä¸ªæˆå‘˜çš„æ•°ç»„ï¼Œæ¯ä¸ªä½ç½®çš„å€¼éƒ½æ˜¯`undefined`ã€‚æ‰©å±•è¿ç®—ç¬¦è½¬æ¢ä¸äº†è¿™ä¸ªå¯¹è±¡ã€‚

å¯¹äºè¿˜æ²¡æœ‰éƒ¨ç½²è¯¥æ–¹æ³•çš„æµè§ˆå™¨ï¼Œå¯ä»¥ç”¨`Array.prototype.slice`æ–¹æ³•æ›¿ä»£ã€‚

```javascript
const toArray = (() =>
  Array.from ? Array.from : obj => [].slice.call(obj)
)();
```

`Array.from`è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œä½œç”¨ç±»ä¼¼äºæ•°ç»„çš„`map`æ–¹æ³•ï¼Œç”¨æ¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œå°†å¤„ç†åçš„å€¼æ”¾å…¥è¿”å›çš„æ•°ç»„ã€‚

```javascript
Array.from(arrayLike, x => x * x);
// ç­‰åŒäº
Array.from(arrayLike).map(x => x * x);

Array.from([1, 2, 3], (x) => x * x)
// [1, 4, 9]
```

ä¸‹é¢çš„ä¾‹å­æ˜¯å–å‡ºä¸€ç»„ DOM èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ã€‚

```javascript
let spans = document.querySelectorAll('span.name');

// map()
let names1 = Array.prototype.map.call(spans, s => s.textContent);

// Array.from()
let names2 = Array.from(spans, s => s.textContent)
```

ä¸‹é¢çš„ä¾‹å­å°†æ•°ç»„ä¸­å¸ƒå°”å€¼ä¸º`false`çš„æˆå‘˜è½¬ä¸º`0`ã€‚

```javascript
Array.from([1, , 2, , 3], (n) => n || 0)
// [1, 0, 2, 0, 3]
```

å¦ä¸€ä¸ªä¾‹å­æ˜¯è¿”å›å„ç§æ•°æ®çš„ç±»å‹ã€‚

```javascript
function typesOf () {
  return Array.from(arguments, value => typeof value)
}
typesOf(null, [], NaN)
// ['object', 'object', 'number']
```

å¦‚æœ`map`å‡½æ•°é‡Œé¢ç”¨åˆ°äº†`this`å…³é”®å­—ï¼Œè¿˜å¯ä»¥ä¼ å…¥`Array.from`çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®š`this`ã€‚

`Array.from()`å¯ä»¥å°†å„ç§å€¼è½¬ä¸ºçœŸæ­£çš„æ•°ç»„ï¼Œå¹¶ä¸”è¿˜æä¾›`map`åŠŸèƒ½ã€‚è¿™å®é™…ä¸Šæ„å‘³ç€ï¼Œåªè¦æœ‰ä¸€ä¸ªåŸå§‹çš„æ•°æ®ç»“æ„ï¼Œä½ å°±å¯ä»¥å…ˆå¯¹å®ƒçš„å€¼è¿›è¡Œå¤„ç†ï¼Œç„¶åè½¬æˆè§„èŒƒçš„æ•°ç»„ç»“æ„ï¼Œè¿›è€Œå°±å¯ä»¥ä½¿ç”¨æ•°é‡ä¼—å¤šçš„æ•°ç»„æ–¹æ³•ã€‚

```javascript
Array.from({ length: 2 }, () => 'jack')
// ['jack', 'jack']
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`Array.from`çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šäº†ç¬¬äºŒä¸ªå‚æ•°è¿è¡Œçš„æ¬¡æ•°ã€‚è¿™ç§ç‰¹æ€§å¯ä»¥è®©è¯¥æ–¹æ³•çš„ç”¨æ³•å˜å¾—éå¸¸çµæ´»ã€‚

`Array.from()`çš„å¦ä¸€ä¸ªåº”ç”¨æ˜¯ï¼Œå°†å­—ç¬¦ä¸²è½¬ä¸ºæ•°ç»„ï¼Œç„¶åè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚å› ä¸ºå®ƒèƒ½æ­£ç¡®å¤„ç†å„ç§ Unicode å­—ç¬¦ï¼Œå¯ä»¥é¿å… JavaScript å°†å¤§äº`ï¿¿`çš„ Unicode å­—ç¬¦ï¼Œç®—ä½œä¸¤ä¸ªå­—ç¬¦çš„ bugã€‚

```javascript
function countSymbols(string) {
  return Array.from(string).length;
}
```

## Array.of()

`Array.of()`æ–¹æ³•ç”¨äºå°†ä¸€ç»„å€¼ï¼Œè½¬æ¢ä¸ºæ•°ç»„ã€‚

```javascript
Array.of(3, 11, 8) // [3,11,8]
Array.of(3) // [3]
Array.of(3).length // 1
```

è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ç›®çš„ï¼Œæ˜¯å¼¥è¡¥æ•°ç»„æ„é€ å‡½æ•°`Array()`çš„ä¸è¶³ã€‚å› ä¸ºå‚æ•°ä¸ªæ•°çš„ä¸åŒï¼Œä¼šå¯¼è‡´`Array()`çš„è¡Œä¸ºæœ‰å·®å¼‚ã€‚

```javascript
Array() // []
Array(3) // [, , ,]
Array(3, 11, 8) // [3, 11, 8]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`Array()`æ–¹æ³•æ²¡æœ‰å‚æ•°ã€ä¸€ä¸ªå‚æ•°ã€ä¸‰ä¸ªå‚æ•°æ—¶ï¼Œè¿”å›çš„ç»“æœéƒ½ä¸ä¸€æ ·ã€‚åªæœ‰å½“å‚æ•°ä¸ªæ•°ä¸å°‘äº 2 ä¸ªæ—¶ï¼Œ`Array()`æ‰ä¼šè¿”å›ç”±å‚æ•°ç»„æˆçš„æ–°æ•°ç»„ã€‚å‚æ•°åªæœ‰ä¸€ä¸ªæ­£æ•´æ•°æ—¶ï¼Œå®é™…ä¸Šæ˜¯æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚

`Array.of()`åŸºæœ¬ä¸Šå¯ä»¥ç”¨æ¥æ›¿ä»£`Array()`æˆ–`new Array()`ï¼Œå¹¶ä¸”ä¸å­˜åœ¨ç”±äºå‚æ•°ä¸åŒè€Œå¯¼è‡´çš„é‡è½½ã€‚å®ƒçš„è¡Œä¸ºéå¸¸ç»Ÿä¸€ã€‚

```javascript
Array.of() // []
Array.of(undefined) // [undefined]
Array.of(1) // [1]
Array.of(1, 2) // [1, 2]
```

`Array.of()`æ€»æ˜¯è¿”å›å‚æ•°å€¼ç»„æˆçš„æ•°ç»„ã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œå°±è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ã€‚

`Array.of()`æ–¹æ³•å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç æ¨¡æ‹Ÿå®ç°ã€‚

```javascript
function ArrayOf(){
  return [].slice.call(arguments);
}
```

## æ•°ç»„å®ä¾‹çš„ copyWithin()

æ•°ç»„å®ä¾‹çš„`copyWithin()`æ–¹æ³•ï¼Œåœ¨å½“å‰æ•°ç»„å†…éƒ¨ï¼Œå°†æŒ‡å®šä½ç½®çš„æˆå‘˜å¤åˆ¶åˆ°å…¶ä»–ä½ç½®ï¼ˆä¼šè¦†ç›–åŸæœ‰æˆå‘˜ï¼‰ï¼Œç„¶åè¿”å›å½“å‰æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¼šä¿®æ”¹å½“å‰æ•°ç»„ã€‚

```javascript
Array.prototype.copyWithin(target, start = 0, end = this.length)
```

å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ã€‚

- targetï¼ˆå¿…éœ€ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹æ›¿æ¢æ•°æ®ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºå€’æ•°ã€‚
- startï¼ˆå¯é€‰ï¼‰ï¼šä»è¯¥ä½ç½®å¼€å§‹è¯»å–æ•°æ®ï¼Œé»˜è®¤ä¸º 0ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®—ã€‚
- endï¼ˆå¯é€‰ï¼‰ï¼šåˆ°è¯¥ä½ç½®å‰åœæ­¢è¯»å–æ•°æ®ï¼Œé»˜è®¤ç­‰äºæ•°ç»„é•¿åº¦ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œè¡¨ç¤ºä»æœ«å°¾å¼€å§‹è®¡ç®—ã€‚

è¿™ä¸‰ä¸ªå‚æ•°éƒ½åº”è¯¥æ˜¯æ•°å€¼ï¼Œå¦‚æœä¸æ˜¯ï¼Œä¼šè‡ªåŠ¨è½¬ä¸ºæ•°å€¼ã€‚

```javascript
[1, 2, 3, 4, 5].copyWithin(0, 3)
// [4, 5, 3, 4, 5]
```

ä¸Šé¢ä»£ç è¡¨ç¤ºå°†ä» 3 å·ä½ç›´åˆ°æ•°ç»„ç»“æŸçš„æˆå‘˜ï¼ˆ4 å’Œ 5ï¼‰ï¼Œå¤åˆ¶åˆ°ä» 0 å·ä½å¼€å§‹çš„ä½ç½®ï¼Œç»“æœè¦†ç›–äº†åŸæ¥çš„ 1 å’Œ 2ã€‚

ä¸‹é¢æ˜¯æ›´å¤šä¾‹å­ã€‚

```javascript
// å°†3å·ä½å¤åˆ¶åˆ°0å·ä½
[1, 2, 3, 4, 5].copyWithin(0, 3, 4)
// [4, 2, 3, 4, 5]

// -2ç›¸å½“äº3å·ä½ï¼Œ-1ç›¸å½“äº4å·ä½
[1, 2, 3, 4, 5].copyWithin(0, -2, -1)
// [4, 2, 3, 4, 5]

// å°†3å·ä½å¤åˆ¶åˆ°0å·ä½
[].copyWithin.call({length: 5, 3: 1}, 0, 3)
// {0: 1, 3: 1, length: 5}

// å°†2å·ä½åˆ°æ•°ç»„ç»“æŸï¼Œå¤åˆ¶åˆ°0å·ä½
let i32a = new Int32Array([1, 2, 3, 4, 5]);
i32a.copyWithin(0, 2);
// Int32Array [3, 4, 5, 4, 5]

// å¯¹äºæ²¡æœ‰éƒ¨ç½² TypedArray çš„ copyWithin æ–¹æ³•çš„å¹³å°
// éœ€è¦é‡‡ç”¨ä¸‹é¢çš„å†™æ³•
[].copyWithin.call(new Int32Array([1, 2, 3, 4, 5]), 0, 3, 4);
// Int32Array [4, 2, 3, 4, 5]
```

## æ•°ç»„å®ä¾‹çš„ find() å’Œ findIndex()

æ•°ç»„å®ä¾‹çš„`find`æ–¹æ³•ï¼Œç”¨äºæ‰¾å‡ºç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜ã€‚å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œæ‰€æœ‰æ•°ç»„æˆå‘˜ä¾æ¬¡æ‰§è¡Œè¯¥å›è°ƒå‡½æ•°ï¼Œç›´åˆ°æ‰¾å‡ºç¬¬ä¸€ä¸ªè¿”å›å€¼ä¸º`true`çš„æˆå‘˜ï¼Œç„¶åè¿”å›è¯¥æˆå‘˜ã€‚å¦‚æœæ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æˆå‘˜ï¼Œåˆ™è¿”å›`undefined`ã€‚

```javascript
[1, 4, -5, 10].find((n) => n < 0)
// -5
```

ä¸Šé¢ä»£ç æ‰¾å‡ºæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå°äº 0 çš„æˆå‘˜ã€‚

```javascript
[1, 5, 10, 15].find(function(value, index, arr) {
  return value > 9;
}) // 10
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`find`æ–¹æ³•çš„å›è°ƒå‡½æ•°å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºå½“å‰çš„å€¼ã€å½“å‰çš„ä½ç½®å’ŒåŸæ•°ç»„ã€‚

æ•°ç»„å®ä¾‹çš„`findIndex`æ–¹æ³•çš„ç”¨æ³•ä¸`find`æ–¹æ³•éå¸¸ç±»ä¼¼ï¼Œè¿”å›ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°ç»„æˆå‘˜çš„ä½ç½®ï¼Œå¦‚æœæ‰€æœ‰æˆå‘˜éƒ½ä¸ç¬¦åˆæ¡ä»¶ï¼Œåˆ™è¿”å›`-1`ã€‚

```javascript
[1, 5, 10, 15].findIndex(function(value, index, arr) {
  return value > 9;
}) // 2
```

è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šå›è°ƒå‡½æ•°çš„`this`å¯¹è±¡ã€‚

```javascript
function f(v){
  return v > this.age;
}
let person = {name: 'John', age: 20};
[10, 12, 26, 15].find(f, person);    // 26
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`find`å‡½æ•°æ¥æ”¶äº†ç¬¬äºŒä¸ªå‚æ•°`person`å¯¹è±¡ï¼Œå›è°ƒå‡½æ•°ä¸­çš„`this`å¯¹è±¡æŒ‡å‘`person`å¯¹è±¡ã€‚

å¦å¤–ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥å‘ç°`NaN`ï¼Œå¼¥è¡¥äº†æ•°ç»„çš„`indexOf`æ–¹æ³•çš„ä¸è¶³ã€‚

```javascript
[NaN].indexOf(NaN)
// -1

[NaN].findIndex(y => Object.is(NaN, y))
// 0
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`indexOf`æ–¹æ³•æ— æ³•è¯†åˆ«æ•°ç»„çš„`NaN`æˆå‘˜ï¼Œä½†æ˜¯`findIndex`æ–¹æ³•å¯ä»¥å€ŸåŠ©`Object.is`æ–¹æ³•åšåˆ°ã€‚

## æ•°ç»„å®ä¾‹çš„ fill()

`fill`æ–¹æ³•ä½¿ç”¨ç»™å®šå€¼ï¼Œå¡«å……ä¸€ä¸ªæ•°ç»„ã€‚

```javascript
['a', 'b', 'c'].fill(7)
// [7, 7, 7]

new Array(3).fill(7)
// [7, 7, 7]
```

ä¸Šé¢ä»£ç è¡¨æ˜ï¼Œ`fill`æ–¹æ³•ç”¨äºç©ºæ•°ç»„çš„åˆå§‹åŒ–éå¸¸æ–¹ä¾¿ã€‚æ•°ç»„ä¸­å·²æœ‰çš„å…ƒç´ ï¼Œä¼šè¢«å…¨éƒ¨æŠ¹å»ã€‚

`fill`æ–¹æ³•è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç”¨äºæŒ‡å®šå¡«å……çš„èµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚

```javascript
['a', 'b', 'c'].fill(7, 1, 2)
// ['a', 7, 'c']
```

ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œ`fill`æ–¹æ³•ä» 1 å·ä½å¼€å§‹ï¼Œå‘åŸæ•°ç»„å¡«å…… 7ï¼Œåˆ° 2 å·ä½ä¹‹å‰ç»“æŸã€‚

æ³¨æ„ï¼Œå¦‚æœå¡«å……çš„ç±»å‹ä¸ºå¯¹è±¡ï¼Œé‚£ä¹ˆè¢«èµ‹å€¼çš„æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ·±æ‹·è´å¯¹è±¡ã€‚

```javascript
let arr = new Array(3).fill({name: "Mike"});
arr[0].name = "Ben";
arr
// [{name: "Ben"}, {name: "Ben"}, {name: "Ben"}]

let arr = new Array(3).fill([]);
arr[0].push(5);
arr
// [[5], [5], [5]]
```

## æ•°ç»„å®ä¾‹çš„ entries()ï¼Œkeys() å’Œ values()

ES6 æä¾›ä¸‰ä¸ªæ–°çš„æ–¹æ³•â€”â€”`entries()`ï¼Œ`keys()`å’Œ`values()`â€”â€”ç”¨äºéå†æ•°ç»„ã€‚å®ƒä»¬éƒ½è¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ï¼ˆè¯¦è§ã€ŠIteratorã€‹ä¸€ç« ï¼‰ï¼Œå¯ä»¥ç”¨`for...of`å¾ªç¯è¿›è¡Œéå†ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯`keys()`æ˜¯å¯¹é”®åçš„éå†ã€`values()`æ˜¯å¯¹é”®å€¼çš„éå†ï¼Œ`entries()`æ˜¯å¯¹é”®å€¼å¯¹çš„éå†ã€‚

```javascript
for (let index of ['a', 'b'].keys()) {
  console.log(index);
}
// 0
// 1

for (let elem of ['a', 'b'].values()) {
  console.log(elem);
}
// 'a'
// 'b'

for (let [index, elem] of ['a', 'b'].entries()) {
  console.log(index, elem);
}
// 0 "a"
// 1 "b"
```

å¦‚æœä¸ä½¿ç”¨`for...of`å¾ªç¯ï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒç”¨éå†å™¨å¯¹è±¡çš„`next`æ–¹æ³•ï¼Œè¿›è¡Œéå†ã€‚

```javascript
let letter = ['a', 'b', 'c'];
let entries = letter.entries();
console.log(entries.next().value); // [0, 'a']
console.log(entries.next().value); // [1, 'b']
console.log(entries.next().value); // [2, 'c']
```

## æ•°ç»„å®ä¾‹çš„ includes()

`Array.prototype.includes`æ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ç»™å®šçš„å€¼ï¼Œä¸å­—ç¬¦ä¸²çš„`includes`æ–¹æ³•ç±»ä¼¼ã€‚ES2016 å¼•å…¥äº†è¯¥æ–¹æ³•ã€‚

```javascript
[1, 2, 3].includes(2)     // true
[1, 2, 3].includes(4)     // false
[1, 2, NaN].includes(NaN) // true
```

è¯¥æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæœç´¢çš„èµ·å§‹ä½ç½®ï¼Œé»˜è®¤ä¸º`0`ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°ä¸ºè´Ÿæ•°ï¼Œåˆ™è¡¨ç¤ºå€’æ•°çš„ä½ç½®ï¼Œå¦‚æœè¿™æ—¶å®ƒå¤§äºæ•°ç»„é•¿åº¦ï¼ˆæ¯”å¦‚ç¬¬äºŒä¸ªå‚æ•°ä¸º`-4`ï¼Œä½†æ•°ç»„é•¿åº¦ä¸º`3`ï¼‰ï¼Œåˆ™ä¼šé‡ç½®ä¸ºä»`0`å¼€å§‹ã€‚

```javascript
[1, 2, 3].includes(3, 3);  // false
[1, 2, 3].includes(3, -1); // true
```

æ²¡æœ‰è¯¥æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ•°ç»„çš„`indexOf`æ–¹æ³•ï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«æŸä¸ªå€¼ã€‚

```javascript
if (arr.indexOf(el) !== -1) {
  // ...
}
```

`indexOf`æ–¹æ³•æœ‰ä¸¤ä¸ªç¼ºç‚¹ï¼Œä¸€æ˜¯ä¸å¤Ÿè¯­ä¹‰åŒ–ï¼Œå®ƒçš„å«ä¹‰æ˜¯æ‰¾åˆ°å‚æ•°å€¼çš„ç¬¬ä¸€ä¸ªå‡ºç°ä½ç½®ï¼Œæ‰€ä»¥è¦å»æ¯”è¾ƒæ˜¯å¦ä¸ç­‰äº`-1`ï¼Œè¡¨è¾¾èµ·æ¥ä¸å¤Ÿç›´è§‚ã€‚äºŒæ˜¯ï¼Œå®ƒå†…éƒ¨ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰è¿ç®—ç¬¦ï¼ˆ`===`ï¼‰è¿›è¡Œåˆ¤æ–­ï¼Œè¿™ä¼šå¯¼è‡´å¯¹`NaN`çš„è¯¯åˆ¤ã€‚

```javascript
[NaN].indexOf(NaN)
// -1
```

`includes`ä½¿ç”¨çš„æ˜¯ä¸ä¸€æ ·çš„åˆ¤æ–­ç®—æ³•ï¼Œå°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚

```javascript
[NaN].includes(NaN)
// true
```

ä¸‹é¢ä»£ç ç”¨æ¥æ£€æŸ¥å½“å‰ç¯å¢ƒæ˜¯å¦æ”¯æŒè¯¥æ–¹æ³•ï¼Œå¦‚æœä¸æ”¯æŒï¼Œéƒ¨ç½²ä¸€ä¸ªç®€æ˜“çš„æ›¿ä»£ç‰ˆæœ¬ã€‚

```javascript
const contains = (() =>
  Array.prototype.includes
    ? (arr, value) => arr.includes(value)
    : (arr, value) => arr.some(el => el === value)
)();
contains(['foo', 'bar'], 'baz'); // => false
```

å¦å¤–ï¼ŒMap å’Œ Set æ•°æ®ç»“æ„æœ‰ä¸€ä¸ª`has`æ–¹æ³•ï¼Œéœ€è¦æ³¨æ„ä¸`includes`åŒºåˆ†ã€‚

- Map ç»“æ„çš„`has`æ–¹æ³•ï¼Œæ˜¯ç”¨æ¥æŸ¥æ‰¾é”®åçš„ï¼Œæ¯”å¦‚`Map.prototype.has(key)`ã€`WeakMap.prototype.has(key)`ã€`Reflect.has(target, propertyKey)`ã€‚
- Set ç»“æ„çš„`has`æ–¹æ³•ï¼Œæ˜¯ç”¨æ¥æŸ¥æ‰¾å€¼çš„ï¼Œæ¯”å¦‚`Set.prototype.has(value)`ã€`WeakSet.prototype.has(value)`ã€‚

## æ•°ç»„å®ä¾‹çš„ flat()ï¼ŒflatMap()

æ•°ç»„çš„æˆå‘˜æœ‰æ—¶è¿˜æ˜¯æ•°ç»„ï¼Œ`Array.prototype.flat()`ç”¨äºå°†åµŒå¥—çš„æ•°ç»„â€œæ‹‰å¹³â€ï¼Œå˜æˆä¸€ç»´çš„æ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¯¹åŸæ•°æ®æ²¡æœ‰å½±å“ã€‚

```javascript
[1, 2, [3, 4]].flat()
// [1, 2, 3, 4]
```

ä¸Šé¢ä»£ç ä¸­ï¼ŒåŸæ•°ç»„çš„æˆå‘˜é‡Œé¢æœ‰ä¸€ä¸ªæ•°ç»„ï¼Œ`flat()`æ–¹æ³•å°†å­æ•°ç»„çš„æˆå‘˜å–å‡ºæ¥ï¼Œæ·»åŠ åœ¨åŸæ¥çš„ä½ç½®ã€‚

`flat()`é»˜è®¤åªä¼šâ€œæ‹‰å¹³â€ä¸€å±‚ï¼Œå¦‚æœæƒ³è¦â€œæ‹‰å¹³â€å¤šå±‚çš„åµŒå¥—æ•°ç»„ï¼Œå¯ä»¥å°†`flat()`æ–¹æ³•çš„å‚æ•°å†™æˆä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæƒ³è¦æ‹‰å¹³çš„å±‚æ•°ï¼Œé»˜è®¤ä¸º1ã€‚

```javascript
[1, 2, [3, [4, 5]]].flat()
// [1, 2, 3, [4, 5]]

[1, 2, [3, [4, 5]]].flat(2)
// [1, 2, 3, 4, 5]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`flat()`çš„å‚æ•°ä¸º2ï¼Œè¡¨ç¤ºè¦â€œæ‹‰å¹³â€ä¸¤å±‚çš„åµŒå¥—æ•°ç»„ã€‚

å¦‚æœä¸ç®¡æœ‰å¤šå°‘å±‚åµŒå¥—ï¼Œéƒ½è¦è½¬æˆä¸€ç»´æ•°ç»„ï¼Œå¯ä»¥ç”¨`Infinity`å…³é”®å­—ä½œä¸ºå‚æ•°ã€‚

```javascript
[1, [2, [3]]].flat(Infinity)
// [1, 2, 3]
```

å¦‚æœåŸæ•°ç»„æœ‰ç©ºä½ï¼Œ`flat()`æ–¹æ³•ä¼šè·³è¿‡ç©ºä½ã€‚

```javascript
[1, 2, , 4, 5].flat()
// [1, 2, 4, 5]
```

`flatMap()`æ–¹æ³•å¯¹åŸæ•°ç»„çš„æ¯ä¸ªæˆå‘˜æ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼ˆç›¸å½“äºæ‰§è¡Œ`Array.prototype.map()`ï¼‰ï¼Œç„¶åå¯¹è¿”å›å€¼ç»„æˆçš„æ•°ç»„æ‰§è¡Œ`flat()`æ–¹æ³•ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œä¸æ”¹å˜åŸæ•°ç»„ã€‚

```javascript
// ç›¸å½“äº [[2, 4], [3, 6], [4, 8]].flat()
[2, 3, 4].flatMap((x) => [x, x * 2])
// [2, 4, 3, 6, 4, 8]
```

`flatMap()`åªèƒ½å±•å¼€ä¸€å±‚æ•°ç»„ã€‚

```javascript
// ç›¸å½“äº [[[2]], [[4]], [[6]], [[8]]].flat()
[1, 2, 3, 4].flatMap(x => [[x * 2]])
// [[2], [4], [6], [8]]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œéå†å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªåŒå±‚çš„æ•°ç»„ï¼Œä½†æ˜¯é»˜è®¤åªèƒ½å±•å¼€ä¸€å±‚ï¼Œå› æ­¤`flatMap()`è¿”å›çš„è¿˜æ˜¯ä¸€ä¸ªåµŒå¥—æ•°ç»„ã€‚

`flatMap()`æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªéå†å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯å½“å‰æ•°ç»„æˆå‘˜ã€å½“å‰æ•°ç»„æˆå‘˜çš„ä½ç½®ï¼ˆä»é›¶å¼€å§‹ï¼‰ã€åŸæ•°ç»„ã€‚

```javascript
arr.flatMap(function callback(currentValue[, index[, array]]) {
  // ...
}[, thisArg])
```

`flatMap()`æ–¹æ³•è¿˜å¯ä»¥æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œç”¨æ¥ç»‘å®šéå†å‡½æ•°é‡Œé¢çš„`this`ã€‚

## æ•°ç»„çš„ç©ºä½

æ•°ç»„çš„ç©ºä½æŒ‡ï¼Œæ•°ç»„çš„æŸä¸€ä¸ªä½ç½®æ²¡æœ‰ä»»ä½•å€¼ã€‚æ¯”å¦‚ï¼Œ`Array`æ„é€ å‡½æ•°è¿”å›çš„æ•°ç»„éƒ½æ˜¯ç©ºä½ã€‚

```javascript
Array(3) // [, , ,]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œ`Array(3)`è¿”å›ä¸€ä¸ªå…·æœ‰ 3 ä¸ªç©ºä½çš„æ•°ç»„ã€‚

æ³¨æ„ï¼Œç©ºä½ä¸æ˜¯`undefined`ï¼Œä¸€ä¸ªä½ç½®çš„å€¼ç­‰äº`undefined`ï¼Œä¾ç„¶æ˜¯æœ‰å€¼çš„ã€‚ç©ºä½æ˜¯æ²¡æœ‰ä»»ä½•å€¼ï¼Œ`in`è¿ç®—ç¬¦å¯ä»¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚

```javascript
0 in [undefined, undefined, undefined] // true
0 in [, , ,] // false
```

ä¸Šé¢ä»£ç è¯´æ˜ï¼Œç¬¬ä¸€ä¸ªæ•°ç»„çš„ 0 å·ä½ç½®æ˜¯æœ‰å€¼çš„ï¼Œç¬¬äºŒä¸ªæ•°ç»„çš„ 0 å·ä½ç½®æ²¡æœ‰å€¼ã€‚

ES5 å¯¹ç©ºä½çš„å¤„ç†ï¼Œå·²ç»å¾ˆä¸ä¸€è‡´äº†ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ä¼šå¿½ç•¥ç©ºä½ã€‚

- `forEach()`, `filter()`, `reduce()`, `every()` å’Œ`some()`éƒ½ä¼šè·³è¿‡ç©ºä½ã€‚
- `map()`ä¼šè·³è¿‡ç©ºä½ï¼Œä½†ä¼šä¿ç•™è¿™ä¸ªå€¼
- `join()`å’Œ`toString()`ä¼šå°†ç©ºä½è§†ä¸º`undefined`ï¼Œè€Œ`undefined`å’Œ`null`ä¼šè¢«å¤„ç†æˆç©ºå­—ç¬¦ä¸²ã€‚

```javascript
// forEachæ–¹æ³•
[,'a'].forEach((x,i) => console.log(i)); // 1

// filteræ–¹æ³•
['a',,'b'].filter(x => true) // ['a','b']

// everyæ–¹æ³•
[,'a'].every(x => x==='a') // true

// reduceæ–¹æ³•
[1,,2].reduce((x,y) => x+y) // 3

// someæ–¹æ³•
[,'a'].some(x => x !== 'a') // false

// mapæ–¹æ³•
[,'a'].map(x => 1) // [,1]

// joinæ–¹æ³•
[,'a',undefined,null].join('#') // "#a##"

// toStringæ–¹æ³•
[,'a',undefined,null].toString() // ",a,,"
```

ES6 åˆ™æ˜¯æ˜ç¡®å°†ç©ºä½è½¬ä¸º`undefined`ã€‚

`Array.from`æ–¹æ³•ä¼šå°†æ•°ç»„çš„ç©ºä½ï¼Œè½¬ä¸º`undefined`ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ä¼šå¿½ç•¥ç©ºä½ã€‚

```javascript
Array.from(['a',,'b'])
// [ "a", undefined, "b" ]
```

æ‰©å±•è¿ç®—ç¬¦ï¼ˆ`...`ï¼‰ä¹Ÿä¼šå°†ç©ºä½è½¬ä¸º`undefined`ã€‚

```javascript
[...['a',,'b']]
// [ "a", undefined, "b" ]
```

`copyWithin()`ä¼šè¿ç©ºä½ä¸€èµ·æ‹·è´ã€‚

```javascript
[,'a','b',,].copyWithin(2,0) // [,"a",,"a"]
```

`fill()`ä¼šå°†ç©ºä½è§†ä¸ºæ­£å¸¸çš„æ•°ç»„ä½ç½®ã€‚

```javascript
new Array(3).fill('a') // ["a","a","a"]
```

`for...of`å¾ªç¯ä¹Ÿä¼šéå†ç©ºä½ã€‚

```javascript
let arr = [, ,];
for (let i of arr) {
  console.log(1);
}
// 1
// 1
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„`arr`æœ‰ä¸¤ä¸ªç©ºä½ï¼Œ`for...of`å¹¶æ²¡æœ‰å¿½ç•¥å®ƒä»¬ã€‚å¦‚æœæ”¹æˆ`map`æ–¹æ³•éå†ï¼Œç©ºä½æ˜¯ä¼šè·³è¿‡çš„ã€‚

`entries()`ã€`keys()`ã€`values()`ã€`find()`å’Œ`findIndex()`ä¼šå°†ç©ºä½å¤„ç†æˆ`undefined`ã€‚

```javascript
// entries()
[...[,'a'].entries()] // [[0,undefined], [1,"a"]]

// keys()
[...[,'a'].keys()] // [0,1]

// values()
[...[,'a'].values()] // [undefined,"a"]

// find()
[,'a'].find(x => true) // undefined

// findIndex()
[,'a'].findIndex(x => true) // 0
```

ç”±äºç©ºä½çš„å¤„ç†è§„åˆ™éå¸¸ä¸ç»Ÿä¸€ï¼Œæ‰€ä»¥å»ºè®®é¿å…å‡ºç°ç©ºä½ã€‚

## Array.prototype.sort() çš„æ’åºç¨³å®šæ€§

æ’åºç¨³å®šæ€§ï¼ˆstable sortingï¼‰æ˜¯æ’åºç®—æ³•çš„é‡è¦å±æ€§ï¼ŒæŒ‡çš„æ˜¯æ’åºå…³é”®å­—ç›¸åŒçš„é¡¹ç›®ï¼Œæ’åºå‰åçš„é¡ºåºä¸å˜ã€‚

```javascript
const arr = [
  'peach',
  'straw',
  'apple',
  'spork'
];

const stableSorting = (s1, s2) => {
  if (s1[0] < s2[0]) return -1;
  return 1;
};

arr.sort(stableSorting)
//Â ["apple", "peach", "straw", "spork"]
```

ä¸Šé¢ä»£ç å¯¹æ•°ç»„`arr`æŒ‰ç…§é¦–å­—æ¯è¿›è¡Œæ’åºã€‚æ’åºç»“æœä¸­ï¼Œ`straw`åœ¨`spork`çš„å‰é¢ï¼Œè·ŸåŸå§‹é¡ºåºä¸€è‡´ï¼Œæ‰€ä»¥æ’åºç®—æ³•`stableSorting`æ˜¯ç¨³å®šæ’åºã€‚

```javascript
const unstableSorting = (s1, s2) => {
  if (s1[0] <= s2[0]) return -1;
  return 1;
};

arr.sort(unstableSorting)
// ["apple", "peach", "spork", "straw"]
```

ä¸Šé¢ä»£ç ä¸­ï¼Œæ’åºç»“æœæ˜¯`spork`åœ¨`straw`å‰é¢ï¼Œè·ŸåŸå§‹é¡ºåºç›¸åï¼Œæ‰€ä»¥æ’åºç®—æ³•`unstableSorting`æ˜¯ä¸ç¨³å®šçš„ã€‚

å¸¸è§çš„æ’åºç®—æ³•ä¹‹ä¸­ï¼Œæ’å…¥æ’åºã€åˆå¹¶æ’åºã€å†’æ³¡æ’åºç­‰éƒ½æ˜¯ç¨³å®šçš„ï¼Œå †æ’åºã€å¿«é€Ÿæ’åºç­‰æ˜¯ä¸ç¨³å®šçš„ã€‚ä¸ç¨³å®šæ’åºçš„ä¸»è¦ç¼ºç‚¹æ˜¯ï¼Œå¤šé‡æ’åºæ—¶å¯èƒ½ä¼šäº§ç”Ÿé—®é¢˜ã€‚å‡è®¾æœ‰ä¸€ä¸ªå§“å’Œåçš„åˆ—è¡¨ï¼Œè¦æ±‚æŒ‰ç…§â€œå§“æ°ä¸ºä¸»è¦å…³é”®å­—ï¼Œåå­—ä¸ºæ¬¡è¦å…³é”®å­—â€è¿›è¡Œæ’åºã€‚å¼€å‘è€…å¯èƒ½ä¼šå…ˆæŒ‰åå­—æ’åºï¼Œå†æŒ‰å§“æ°è¿›è¡Œæ’åºã€‚å¦‚æœæ’åºç®—æ³•æ˜¯ç¨³å®šçš„ï¼Œè¿™æ ·å°±å¯ä»¥è¾¾åˆ°â€œå…ˆå§“æ°ï¼Œååå­—â€çš„æ’åºæ•ˆæœã€‚å¦‚æœæ˜¯ä¸ç¨³å®šçš„ï¼Œå°±ä¸è¡Œã€‚

æ—©å…ˆçš„ ECMAScript æ²¡æœ‰è§„å®šï¼Œ`Array.prototype.sort()`çš„é»˜è®¤æ’åºç®—æ³•æ˜¯å¦ç¨³å®šï¼Œç•™ç»™æµè§ˆå™¨è‡ªå·±å†³å®šï¼Œè¿™å¯¼è‡´æŸäº›å®ç°æ˜¯ä¸ç¨³å®šçš„ã€‚[ES2019](https://github.com/tc39/ecma262/pull/1340) æ˜ç¡®è§„å®šï¼Œ`Array.prototype.sort()`çš„é»˜è®¤æ’åºç®—æ³•å¿…é¡»ç¨³å®šã€‚è¿™ä¸ªè§„å®šå·²ç»åšåˆ°äº†ï¼Œç°åœ¨ JavaScript å„ä¸ªä¸»è¦å®ç°çš„é»˜è®¤æ’åºç®—æ³•éƒ½æ˜¯ç¨³å®šçš„ã€‚

